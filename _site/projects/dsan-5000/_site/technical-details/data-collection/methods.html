<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>methods – DSAN-5000: Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/gu-logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6bd9cfa162949bde0a231f530c97869d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../assets/styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">DSAN-5000: Project</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../report/report.html"> 
<span class="menu-text">Report</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-technical-details" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Technical details</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-technical-details">    
        <li>
    <a class="dropdown-item" href="../../technical-details/data-collection/main.html">
 <span class="dropdown-text">Data-collection</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/data-cleaning/main.html">
 <span class="dropdown-text">Data-cleaning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/eda/main.html">
 <span class="dropdown-text">Exploratory Data Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/unsupervised-learning/main.html">
 <span class="dropdown-text">Unsupervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/supervised-learning/main.html">
 <span class="dropdown-text">Supervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/progress-log.html">
 <span class="dropdown-text">Progress Log</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/llm-usage-log.html">
 <span class="dropdown-text">LLM usage Log</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#methods" id="toc-methods" class="nav-link active" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link" data-scroll-target="#data-collection">Data collection</a></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">Data cleaning</a></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</a></li>
  <li><a href="#machine-learning" id="toc-machine-learning" class="nav-link" data-scroll-target="#machine-learning">Machine learning</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="methods" class="level1">
<h1>Methods</h1>
<section id="data-collection" class="level3">
<h3 class="anchored" data-anchor-id="data-collection">Data collection</h3>
<p>All of the data used in this project was stored in CSV files in tabular format.</p>
<p>Data collection methods for this project included manual csv downloads, manual data entry, and extracting data from online sites using public APIs and parsing webpages using BeautifulSoup. The variables included in the dataset are listed below, alongside the source from which they were extracted and the method in which they were extracted.</p>
<p>All of the data from the <strong>UNODC</strong> was downloaded from <a href="https://dataunodc.un.org/dp-trafficking-persons">dataUNDOC’s</a> page on trafficking in persons, which contains the world’s most official reports on human trafficking variables.</p>
<p>The World Bank’s public API was used to extract information on relevant factors influencing the human trafficking responses and patterns identified from the literature review. The base url of the API takes two inputs: the country ISO code and the indicator code. I manually found the datasets on their web pages and copied their indicator abbreviation codes from the URL of the page. These indicators were stored in a dictionary called indicators so they could be looped as inputs to the base url and their data fetched. I also specified the country ISO codes so that data would only be extracted for countries in Europe and Central Asia. ChatGPT was consulted to create the list of countries, given my specified geographic region. I then confirmed with the International Organization for Standards’s official website. Since I was running into trouble extracting the data in an appropriate format on my own, ChatGPT was also consulted for specifying the parameters and specifications in the fetch_indicator_data function, which helped me work around the data being stored in the second list.</p>
<p>Python’s package BeautifulSoup was also used to parse data from two Wikipedia pages on the USDS Tier placement over time and Henley Passport Index per country. BeautifulSoup accomplishes web scraping by parsing the HTML content of the webpage. It accesses the raw HTML content of the webpage and extracts the specified information through its creation of a “parse tree”. Additional methods such as find(), find_all(), or tag navigation can be used to locate and extract the desired data.</p>
<p>The variables included in the preliminary merged dataset to be manipulated in the data cleaning phase contained these variables:</p>
<ul>
<li>Country</li>
<li>Year</li>
<li>Detected victims of human trafficking (UNODC)</li>
<li>Human trafficking convictions per country (UNODC)</li>
<li>Human trafficking prosecutions per country (UNODC)</li>
<li>Population (World Bank)</li>
<li>GDP per capita (World Bank)</li>
<li>Unemployment rate (World Bank)</li>
<li>Criminal justice score (World Bank)</li>
<li>Political stability (World Bank)</li>
<li>Percentage of population that are refugees (World Bank)</li>
<li>Tier placement in 2024 (<a href="https://www.state.gov/reports/2024-trafficking-in-persons-report/">2024 USDS Trafficking in Persons report</a>)</li>
<li>Tier placements every year from 2013-2023 (<a href="https://en.wikipedia.org/wiki/Trafficking_in_Persons_Report">Wikipedia</a>)</li>
<li>Victim nonpunishment policy (manually extracted and input into dataset from <a href="https://www.ohchr.org/sites/default/files/Documents/Issues/Trafficking/submissions-HRC47/Regional-Orgs-UN-Agencies/GRETA.pdf">GRETA’s non-punishment principle report</a>)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li>Prostitution policy (manually extracted and input into dataset from the <a href="https://www.europarl.europa.eu/RegData/etudes/IDAN/2024/762354/EPRS_IDA(2024)762354_EN.pdf">European Parliament</a>)</li>
<li>Number of visa-free destinations with national passport (also known as Henley passport index) (<a href="https://en.wikipedia.org/wiki/Henley_Passport_Index">Wikipedia</a>)</li>
<li>EU membership (manually extracted and input into dataset from the <a href="https://eur-lex.europa.eu/EN/legal-content/glossary/member-states.html#:~:text=Now%20there%20are%2027%20Member,%2C%20Slovakia%2C%20Finland%20and%20Sweden.">E.U. official site</a>)</li>
<li>Post-soviet membership (manually extracted and input into dataset from <a href="https://en.wikipedia.org/wiki/Post-Soviet_states">Wikipedia</a>)</li>
<li>GSI Government Response Score
<ul>
<li>The <a href="https://www.walkfree.org/global-slavery-index/downloads/">Global Slavery Index (GSI) dataset</a> is codified and presented by Walk Free, an international human rights-based nonprofit that streamlines research and calls for policy reform into modern slavery, an umbrella term that encompasses exploitation, forced labour, human trafficking and forced marriage</li>
<li>The government response score is one metric developed in the GSI dataset among many others. The score is based on the country’s status on dozens of activity criteria fulfillments</li>
<li>To extract the GSI government response score per country, the Total accumulation of points of criteria satisfaction was taken from the sheet in the dataset with the results</li>
</ul></li>
</ul>
<p>The raw datasets can be found here:</p>
<p><a href="../../data/raw-data/UNODC_TIP_data.xls">UNODC data</a> <a href="../../data/raw-data/europe_world_bank_data.csv">World Bank data</a> <a href="../../data/raw-data/henley_passport_index.csv">Visa free destinations data</a> <a href="../../data/raw-data/TIP_Tiers_overyears.csv">Tier placements over time</a> <a href="../../data/raw-data/EU_Policy.xlsx">Policy data (all manually extracted)</a> <a href="../../data/raw-data/2023-Global-Slavery-Index-Data.xlsx">GSI Government response score</a></p>
<p>The resulting CSV file with all of this combined data had 565 rows for each unique combination of country and year. While some variables (namely, the data from the UNODC, World Bank, and Tier placement over time) had data over time, the rest of the indicators were static variables– meaning a single value was extracted per country. These values were repeated for every combination of year and country, per country.</p>
<p>However, temporal data of this kind violates the I.I.D. (independently and identically distributed) assumption of data for use in machine learning algorithms. In order to be able to use this data for supervised and unsupervised learning, the temporal data had to be manipulated into single point estimates characterizing the indicator’s nature over time. This was completed in the data cleaning section of the project.</p>
</section>
<section id="data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning">Data cleaning</h3>
<p>Various functions in from python’s pandas package were deployed for data cleaning: the standardization of country naming, the merging of different datasets, the aggregation of temporal data into single metrics for input into machine learning models, and more.</p>
<p>Country names were standardized to common country title representations by first comparing the differing denotations between the UNODC and World Bank datasets, and then manually writing a mapping tool to change any instance of a certain presentation of the country title to the preferred one. For example, the Czech Republic was listed as “Czechoslovakia” in some sources, and Turkey denoted as “Turkiye”.</p>
<p>Using pandas tools, the temporal data was aggregated to single metrics for input into the machine learning models to represent either the rate of change of the variable over time, the mean value over time, or the sum of values. Some variables included more than one aggregate representation. ChatGPT was consulted in the process of brainstorming how to approach this data manipulation strategy by prompting the LLM with the question: “What are the best ways to force data with temporal component to obey IID assumptions?” The rate of change was calculated as the regression slope between each successive change between consecutive years using the <code>scipy.stat's linregress</code> tool in python. The final dataset for input into the machine learning models thus contained the following variables. The shape of the dataset is (46,43), indicating 46 rows for each unique country and 43 final indicators. Any variable titles ending in _sum represent the total accumulated count of the value over the years. Any ending in _mean represent the mean value over the years. Any ending in _slope represent the general regression slope of the value over the years, for which a positive value indicates that the indicator has been increasing over the years.</p>
<p>The following variables composed the final, aggregated dataset for input into the machine learning models:</p>
<ul>
<li>Country</li>
<li>Subregion</li>
<li>Detected_victims_sum</li>
<li>Detected_victims_slope</li>
<li>Convicted_traffickers_sum</li>
<li>Convicted_traffickers_slope</li>
<li>Prosecuted_traffickers_sum</li>
<li>Prosecuted_traffickers_slope</li>
<li>Convictions_over_prosecutions_mean</li>
<li>Number_Repatriated_Victims_sum</li>
<li>Tier_mean</li>
<li>Tier_slope</li>
<li>Criminal_justice_mean</li>
<li>Criminal_justice_slope</li>
<li>GDP_per_capita_mean</li>
<li>GDP_per_capita_slope</li>
<li>Political_stability_mean</li>
<li>Political_stability_slope</li>
<li>Population_mean</li>
<li>Refugee_population_mean</li>
<li>Refugee_population_slope</li>
<li>Unemployment_rate_mean</li>
<li>Unemployment_rate_slope</li>
<li>Detections_per_100_mean</li>
<li>Reported_Years_Detected_Victims</li>
<li>Nonpunishment_policy_before2021</li>
<li>Nonpunishment_policy_after2021</li>
<li>Limited_nonpunishment_policy</li>
<li>Post_soviet_states</li>
<li>EU_members</li>
<li>Visa_free_destinations</li>
<li>GSI_gov_response_score</li>
<li>prostitution_policy</li>
<li>Tier_2024</li>
</ul>
<p><a href="../../data/processed-data/MLdataset.csv">Download the final dataset</a></p>
</section>
<section id="exploratory-data-analysis-eda" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</h3>
<p>The data visualization component of this project utilizes numerous python packages, including <code>pandas, numpy, matplotlib.pyplot, and plotly.express</code>, including its choropleth tool for the creation of interactive, time-based maps. Interactive maps, correlation matrix heatmaps, pairplots, line graphs, bar plots and boxplots were all generated to perform visual perspectives of the data. Furthermore, statistical hypothesis tests such as the t-test and Kruskal-Wallis test with Dunn’s pairwise analysis were performed to assess the statistical significance of differences between levels of categorical variables.</p>
<ul>
<li>The <strong>t-test</strong> is a hypothesis test that compares the <em>means</em> of two groups.
<ul>
<li>Assumptions:
<ol type="1">
<li>Normality: the data in each group should be roughly Normally distributed</li>
<li>Equality of variances: the variance of each group should be approximately the same
<ul>
<li>If this assumption can’t be confirmed, Welch’s t-test can be performed</li>
</ul></li>
</ol></li>
<li>Types of t-tests:
<ol type="1">
<li>One-sample t-test: assesses if the mean of one group differs significantly from the known population mean</li>
<li>Independent two-sample t-test: Compares the means of two independent groups to determine if they are significantly different.</li>
<li>Paired t-test: Compares the means of two related groups (for example, before-and-after measurements)</li>
</ol></li>
<li>For the EDA in this project, <em>Welch’s two-sample independent t-test</em> will be performed using <code>scipy.stats.ttest_ind</code></li>
</ul></li>
<li>The <strong>Kruskal-Wallis test</strong> compares the <em>medians</em> of three or more independent groups to determine any statistically significant differences using <code>scipy.stats.kruskal</code>
<ul>
<li>Non-parametric alternative to ANOVA</li>
<li>Non-parametric: means that the test does not depend on assumptions like Normality or equality of variances</li>
<li>Test statistic is calculted by the rank sums of observations in each group</li>
<li>Works well for small sample sizes or groups with varying sample sizes</li>
<li>When the Kruskal-Wallis test detects a significant difference, Dunn’s test is used for pairwise comparisons between groups to determine which specific groups differ (using <code>scikit_posthocs</code>)</li>
</ul></li>
</ul>
</section>
<section id="machine-learning" class="level3">
<h3 class="anchored" data-anchor-id="machine-learning">Machine learning</h3>
<p>The supervised and unsupervised components used various tools in python’s <code>sklearn</code> packages for different machine learning tasks, as well as specific python packages for more specific models, such as <code>xgboost</code>. The models used are briefly outlined below, with more specific and detailed explanations in the respective section of the project report in which they are applied.</p>
<p><strong>Unsupervised Learning</strong></p>
<ul>
<li>Dimensionality Reduction:
<ul>
<li>Principal Component Analysis (PCA): Reduces data dimensions by transforming features into orthogonal principal components while retaining maximum variance</li>
<li>t-Distributed Stochastic Neighbor Embedding (t-SNE): Projects high-dimensional data into a lower-dimensional space, preserving local structure for visualization</li>
</ul></li>
<li>Clustering Methods:
<ul>
<li>K-Means: Partitions data into clusters by minimizing intra-cluster Euclidean distances</li>
<li>Density-Based Spatial Clustering of Applications with Noise (DBSCAN): Groups data points based on density, detecting clusters of varying shapes while labeling outliers as noise</li>
<li>Hierarchical Clustering: Groups data points by constructing a hierarchy of clusters using an agglomerative (bottom-up) or divisive (top-down) approach</li>
</ul></li>
</ul>
<p><strong>Supervised Learning</strong></p>
<ul>
<li>Classification Methods:
<ul>
<li>Logistic Regression: Predicts binary outcomes using a logistic function</li>
<li>Random Forest: Ensemble method using decision trees to improve accuracy and reduce overfitting</li>
<li>Naive Bayes: Probabilistic classifier based on Bayes’ theorem, assuming feature independence</li>
<li>XGBoost: Gradient-boosting algorithm that combines multiple weak learners for robust classification</li>
</ul></li>
<li>Regression Methods:
<ul>
<li>Lasso Regression: Linear regression with L1 regularization to enforce sparsity and prevent overfitting</li>
<li>Random Forest Regressor: Uses ensemble decision trees to model non-linear relationships in regression tasks</li>
</ul></li>
</ul>
<p>As noted, please see the respective unsupervised and supervised learning sections of this project for more detailed explanations of the models alongside their code applications.</p>
<p><em>All code in this project was executed using the programming language Python in Jupyter notebooks, and this website was assembled using Quarto.</em></p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The Group of Experts on Action against Trafficking in Human Beings <a href="https://www.coe.int/en/web/anti-human-trafficking/greta">(GRETA)</a> is responsible for monitoring the implementation of the Council of Europe Convention on Action against Trafficking in Human Beings by the Parties. It conducts research and publishes country reports evaluating government activities and performance.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>